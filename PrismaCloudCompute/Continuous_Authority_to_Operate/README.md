# Continuous Authority to Operate

This repository contains scripts to implement the Continuous Authority to Operate framework.

## Updates:
* 20201023 - Works with v20.09 API and CSV output has been modified to work with [bulk_tagger.py python script](https://github.com/twistlock/sample-code/blob/f01089aa7a0b00f025397618ebb3de97e60d70ba/computeAPI/cve_tags/bulk_tagger.py)
* 20201109 - Up to date [**tags.csv**](tags.csv) to demonstrate CATO with tag groups _ATO-FrontEnd-POAM_ and _ATO-FrontEnd-Mitigating_Controls_.
Video overview of the CATO framework with Prisma Cloud Compute can be viewed [here.](https://www.youtube.com/watch?v=3Rz1xIP0-GQ)

## Scripts:
**CATO-collection_query.ps1** - This script is used for the "Continuous Authority to Operate" (C-ATO) concepts to identify all vulnerabilities associated with a [Collection](https://docs.paloaltonetworks.com/prisma/prisma-cloud/20-09/prisma-cloud-compute-edition-admin/configure/collections.html) of images. The output is a CSV file containing all the unique CVE/packages found in all the images within a collection. An ATO Auditor can make the determination of what [Tag](https://docs.paloaltonetworks.com/prisma/prisma-cloud/20-09/prisma-cloud-compute-edition-admin/configure/tags.html) they want to associate with each CVE. The CSV file is then used as input for the CATO-tag_population.ps1 script to associate CVEs to Tags within the Console.

  * Logic:
    1. Generates a list of all the images within a Collection supplied as a command line argument.
    2. Queries for unique images in Deployed Images, Registry and CI. Images found in multiple locations are counted once.
    3. Calls "Unique_CVE" function to identify all the CVE/packages found in all the unique images.
    4. Generates a CSV output file for the ATO Auditor to review and associate Tags.


  * Modify:
    * Change the _$tlconsole_ variable for your Prisma Cloud Compute's API URL


  * Input:
    * Name of the Prisma Cloud Compute Collection for the ATO boundary. For example, "ATO-20200601-1" is a Collection of images that have the Label "ATO-20200601-1." You will be prompted for username/password
    ```
    ./CATO-collection_query.ps1 ATO-20200601-1
    ```


  * Output:
    * The number of unique images, number of unique CVE/packages and the name for the output CSV.
    ```
    Checking for images within collection: ATO-20200601-1
    PowerShell credential request
    Enter your credentials.
    User: pfox
    Password for user pfox: *********
    Unique Images:  9
    Unique CVE/packages found:  505
    Output CSV: 20200625-121538-ATO-20200601-1-cves.csv
    ```



**CATO-tag_population.ps1** - This script uses the output CSV generated but the _CATO-collection_query.ps1_ script as input. An ATO Auditor makes the determination of what Tag they want to associate with each CVE. The CSV file is then used as input for this script to associate CVEs to Tags within the Console.

  * Prerequisites:
    1. Create Tags within the Console that the vulnerabilities will be associated to.
    2. Update the "Tag" column for every vulnerability with the Tag name in the CSV generated by the _CATO-collection_query.ps1_ script


  * Logic:
    1. Reads in the CSV supplied as command lime argument.
    2. Associates CVEs to Tags.

  * Modify:
    * Change the _$tlconsole_ variable for your Prisma Cloud Compute's API URL

  * Input:
      * Name of CSV generated by the _CATO-collection_query.ps1_ which has been updated by an Auditor to associate vulnerabilities with Tags.
      For example, fixed vulnerabilities are tagged _ATO-20200601-POAM_ vulnerabilities without fixes are tagged _ATO-20200601-Mitigating_Controls_.
      ```
      tag,cve,packageName,comment,timeAdded
      ATO-20200601-POAM,CVE-2016-9843,zlib,fixed in 1.2.11-r0,
      ATO-20200601-POAM,CVE-2016-9842,zlib,fixed in 1.2.11-r0,
      ATO-20200601-Mitigating_Controls,CVE-2020-1751,glibc,affected,
      ATO-20200601-Mitigating_Controls,CVE-2020-1752,glibc,affected,
      ATO-20200601-Mitigating_Controls,CVE-2019-15903,expat,affected,
      ```

      * Execute the following command with the modified CSV as a command line parameter.
      ```
      ./CATO-tag_population.ps1 20200625-121538-ATO-20200601-1-cves.csv
      ```

  * Output:
    * The number of CVEs associated to Tags.
    ```
    Importing 20200625-121538-ATO-20200601-1-cves.csv
    PowerShell credential request
    Enter your credentials.
    User: pfox
    Password for user pfox: *********
    Associated 505 CVEs to Tags
    ```

## Example CSV
[**Tags.csv**](tags.csv) is an example tags / CVE importer for the [API](https://cdn.twistlock.com/docs/api/twistlock_api.html#tags).
Create two [tag groups](https://docs.paloaltonetworks.com/prisma/prisma-cloud/20-09/prisma-cloud-compute-edition-admin/configure/tags.html) _ATO-FrontEnd-POAM_ (any CVE with a "fixed" status) and _ATO-FrontEnd-Mitigating_Controls_ (any CVE without a "fixed" status).
Use the [bulk_tagger.py](https://github.com/twistlock/sample-code/blob/master/computeAPI/cve_tags/bulk_tagger.py) python script or [CATO-tag_population.ps1](#Scripts) powershell script to import the CVEs into the tag groups within your Console.


## Prerequisite:
[Powershell v6+](https://docs.microsoft.com/en-us/powershell/scripting/install/installing-powershell?view=powershell-7)

Feel free to port to your language of choice.
